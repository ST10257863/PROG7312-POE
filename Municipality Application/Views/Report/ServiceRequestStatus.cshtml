@model Municipality_Application.ViewModels.ServiceRequestStatusPageViewModel

@{
    ViewData["Title"] = "Service Request Status";
}

@section Scripts {
    <script src="~/js/google-autocomplete.js"></script>
    <script src="~/js/location-warning.js"></script>
    <script src="~/js/service-request-filters.js"></script>
    <google-maps-script callback="initGoogleAutocompleteForSearchArea"></google-maps-script>
}

<div class="container mt-4">
    <h2 class="table-title">Service Request Status</h2>
    <form method="get" class="mb-4">
        <div class="row g-3">
            <!-- First row: Description, Location, Category, Status -->
            <div class="col-md-3">
                <input type="text" name="SearchTitle" value="@Model.SearchTitle" class="form-control" placeholder="Search by description" />
            </div>
            <div class="col-md-3">
                <input type="text" id="SearchArea" name="SearchArea" value="@Model.SearchArea" class="form-control" placeholder="Search by area" />
            </div>
            <div class="col-md-3">
                <select name="CategoryId" class="form-select">
                    <option value="">All Categories</option>
                    @if (Model.Categories != null)
                    {
                        foreach (var category in Model.Categories)
                        {
                            <option value="@category.Id" selected="@(Model.CategoryId == category.Id ? "selected" : null)">@category.Name</option>
                        }
                    }
                </select>
            </div>
            <div class="col-md-3">
                <select name="Status" class="form-select">
                    <option value="">All Statuses</option>
                    @if (Model.Statuses != null)
                    {
                        foreach (var status in Model.Statuses)
                        {
                            <option value="@status.Value" selected="@(Model.Status == status.Value ? "selected" : null)">@status.Text</option>
                        }
                    }
                </select>
            </div>
        </div>
        <div class="row g-3 mt-2 align-items-end">
            <!-- Second row: Date range and preset dropdown -->
            <div class="col-md-3">
                <label for="StartDate" class="form-label mb-0">From</label>
                <input type="date" id="StartDate" name="StartDate" value="@(Model.StartDate?.ToString("yyyy-MM-dd"))" class="form-control" />
            </div>
            <div class="col-md-3">
                <label for="EndDate" class="form-label mb-0">To</label>
                <input type="date" id="EndDate" name="EndDate" value="@(Model.EndDate?.ToString("yyyy-MM-dd"))" class="form-control" />
            </div>
            <div class="col-md-3">
                <label for="DateRangePreset" class="form-label mb-0">Quick Range</label>
                <select id="DateRangePreset" class="form-select" onchange="setDateRangePreset()">
                    <option value="">-- Date Range Preset --</option>
                    <option value="thisMonth">This Month</option>
                    <option value="last30">Last 30 Days</option>
                    <option value="thisYear">This Year</option>
                    <option value="last365">Last 365 Days</option>
                </select>
            </div>
            <div class="col-md-3 d-flex align-items-end">
                <button type="submit" class="btn btn-primary w-100">Search</button>
            </div>
        </div>
        <div id="location-warning" class="alert alert-warning mt-2" style="display:none;">
            <strong>Location services are currently unavailable.</strong> We apologise for the inconvenience.
        </div>
        <input type="hidden" id="SearchArea_Latitude" name="SearchArea.Latitude" />
        <input type="hidden" id="SearchArea_Longitude" name="SearchArea.Longitude" />
    </form>

    <div class="table-responsive">
        <table class="table custom-table table-bordered table-hover align-middle">
            <thead>
                <tr>
                    <th style="width: 60px;">#</th>
                    <th>Description</th>
                    <th>Address</th>
                    <th>Date Reported</th>
                    <th>Status</th>
                    <th>Category</th>
                </tr>
            </thead>
            <tbody>
                @{
                    int rowNumber = 1;
                    foreach (var report in Model.Results)
                    {
                        <tr>
                            <td>@rowNumber</td>
                            <td title="@report.Description">@report.Description</td>
                            <td title="@report.Address">@report.Address</td>
                            <td>@report.ReportedAt.ToString("yyyy-MM-dd")</td>
                            <td>
                                <span class="badge @(report.Status == "Resolved" ? "bg-success" : report.Status == "In Progress" ? "bg-warning text-dark" : "bg-secondary")">
                                    @report.Status
                                </span>
                            </td>
                            <td title="@report.Category">@report.Category</td>
                        </tr>
                        rowNumber++;
                    }
                }
            </tbody>
        </table>
    </div>
</div>